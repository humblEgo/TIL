1. 학습 날짜 // 2020-11-17(화)
2. 학습시간 // 9:00~22:00

3. 학습 범위 및 주제 // webserv 오류
4. 동료 학습 방법 // yohai님과 페어프로그래밍, sanam님과 토의
5. 학습 목표 // CGI 통신시 발생하는 오류의 원인을 확인하여 제거한다.

---

6. 상세 학습 내용

![image](https://user-images.githubusercontent.com/54612343/99902794-be8d1180-2d03-11eb-90e5-5c90548be584.png)

### 문제) CGI와 통신을 주고 받는 과정에서, 그야말로 아무런 전조도 없이 갑자기 서버 프로그램이 종료되는 문제가 있었다.

### 해결) signal(SIGINT, NULL) 을 프로그램 시작시 실행시켜 SIGINT 시그널을 무시하도록 수정하였다.

제일 처음 이 문제를 만났을 때는 너무 황당했는데 오류가 발생했다면 throw가 되어야하고 그럼 catch 되어 무엇이 문제인지 출력되어야함에도 불구하고, 그야말로 아무런 '전조도 없이' 갑자기 프로그램이 종료되었기 때문이다. 혹시 던져진 throw를 잡지 못한 것은 아닌지 모든 throw 구문에 log코드를 다시금 심어보았으나 여전히 throw와 별개로 오류가 발생하는 것이었다. 그래도 심어놓은 로그들을 추적하고, 추가로 로그를 심었더니 프로그램을 종료시킨 주범을 알게되었다. `write` , 피씬 때부터 함께해왔던 이 익숙한 친구가 알고보니 소리없는 암살자였던 것이다. 여기에 프로그램이 종료되는 조건을 되짚어보았더니 `write` 함수가 **broken pipe 등의 사유로 SIGINT 시그널을 발생시키는 것을 알게 되었다..!** 아니 `write` 이 녀석은 오류나면 -1이나 리턴할 것이지 시그널을 던지고 있네?! ㅎㅎㅎㅎ이 녀석ㅎㅎ :) 

이를 해결하기 위해 signal_handler를 따로 만들어서 문제가된 소켓을 종료하고 각종 변수를 초기화해보려 하였으나, singal_handler에는 signo 외에 다른 변수를 전달할 수가 없으므로 전역변수로 해결하는 방법 밖에 없다는 걸 알게되었고 뭔가 자연스러운 처리방법이 아니라는 느낌이 들어서 다른 방법을 고려해보기로 했다.

방법을 검색해보았더니 이는 서버프로그래밍 하는 분들이 하는 단골 질문 중 하나였고 금방 [해답](https://codereview.stackexchange.com/questions/823/handling-sigint-signal-for-a-server-program)을 찾을 수 있었다. 그렇다, **SIGINT를 무시하도록 설정**해버리면 되는 것이었다. write함수의 SIGINT는 write 대상 fd가 닫히거나 write 불가한 경우 발생한다. 서버가 write한참하고 있는데 클라이언트가 close해버리거나 비정상종료되면 SIGINT가 발생하는 것이다. 이는 서버측에서 제어할 수 없기 때문에 SIGINT를 무시해야한다. (왜 이게 CGI랑 통신할 때 발생하는지는 따로 파악해보자.)

그럼 `write`는 한차례 SIGINT 시그널을 보낸 후 얌전히 -1을 리턴하고, 이를 분기삼아 에러핸들링이 가능하다.




---

7. 학습 내용에 대한 개인적인 총평

문제가 나는 것은 상당히 짜증날 수 있지만 문제의 원인을 추측해보고 논리적으로 좁혀가는 과정 자체는 즐길만한 것 같습니다. 이왕 버그 찾는 것, 마치 추리소설의 탐정이 된 것처럼 범인을 찾아나서는 기분을 느끼려고 노력해봅니다! 나머지 메소드 구현은 sanam께서 맡아주시기로 했으니 이제 yohai님과 CGI 관련 구현을 마무리하면 진짜 테스터를 온전히 돌려볼 수 있겠네요ㅎㅎ



---

다음 학습 계획

- CGI 통신

