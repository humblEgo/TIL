## 전송 계층(transport layer)

목적지에 신뢰할 수 있는 데이터를 전달하기 위해 필요한 계층이다. 이를 위해 **오류를 점검하는 기능**이 있고, **전송된 데이터의 목적지가 어떤 애플리케이션인지 식별하는 기능**을 가지고 있다.

- 연결형 통신 : 상대편과 확인해 가면서 통신하는 방식으로, **신뢰성/정확성**이 상대적으로 높다. 연결형 통신 프로토콜로는 **TCP(Transmission Control Protocol, 전송 제어 프로토콜)**가 쓰인다.
- 비연결형 통신 : 상대편을 확인하지 않고 일방적으로 데이터를 전송하는 방식으로, **효율성**이 높다. 주로 속도가 중요한 동영상 전송에 쓰인다. 비연결형 통신 프로토콜로는 **UDP(User Datagram Protocol, 사용자 데이터그램 프로토콜)**이 쓰인다.

참고) [Why does DHCP use UDP and not TCP?](https://networkengineering.stackexchange.com/questions/64401/why-does-dhcp-use-udp-and-not-tcp)

### TCP(Trnasmission Control-Protocol)

전송 계층에서 TCP로 전송할 때는 데이터에 **TCP 헤더**를 붙여서 **세그먼트(segment)**로 만든 뒤 이를 전송한다. TCP 헤더에는 아래 정보가 포함된다.

1.  출발지 포트 번호(16비트)
2.  목적지 포트 번호(16비트)
3.  일련번호(32비트)

    - 송신 측에서 수신 측에 전송된 데이터가 원래 데이터의 **몇 번째 데이터인지**를 알려주는 역할함.

4.  확인 응답 번호(32비트)

    - 수신 측이 **몇 번째 데이터**를 수신했는지를 송신 측에 알려주는 역할함.
    - 다음 번호의 데이터를 요청하는데도 사용되며, 이를 **확인 응답**이라고 한다.

5.  헤더 길이(4비트)
6.  예약 영역(6비트)
7.  코드 비트(6비트): SYN, ACK, FIN 등의 정보를 담고 있고 평소에 0으로 값이 담겨있다가, '연결' 확립 요청 및 응답시 1로 활성화되는 식으로 작동한다.
8.  윈도우 크기(16비트): 받은 세그먼트를 일시적으로 저장하는 **버퍼(Buffer)**의 한계크기를 저장하는 값. 오버플로우를 방지한다.
9.  체크섬(16비트)
10. 긴급 포인터(16비트)
11. 옵션

데이터 전송시에는 아래 과정을 거친다.

1. '연결' 확보, 이 `연결`은 TCP에서 데이터를 주고 받기 위한 가상의 독점 통신로를 뜻한다.

   - **3-way 핸드셰이크**: 연결을 확립하기 위해 패킷 요청을 세번 교환하는 것. 최초 일련번호, 최초 확인응답번호, 윈도우 크기 등을 함께 판단한다.

2. 3-way 핸드셰이크에서 확립된 일련번호와 확인 응답 번호를 이용하여 데이터를 주고 받음.

   - **재전송 제어**: 일련번호와 확인 응답 번호를 사용해서 데이터 손상, 유실 여부가 확인되면, 데이터를 재전송한다.

#### 포트 번호

포트 번호는 전송된 데이터의 목적지가 어떤 애플리케이션인지 구분할 수 있도록 한다. 0~65535번을 사용할 수 있으며, **0~1023번 포트**는 주요 프로토콜이 사용하도록 예약되어있다. 이를 **Well-known ports**라고 한다. 1025번 이상은 **랜덤 포트**라고 해서 클라이언트 측의 송신 포트로 사용된다.

**Well-known ports 예시**
|애플리케이션|포트 번호|
|----|----|
|SSH|22|
|SMTP|25|
|DNS|53|
|HTTP|80|
|POP3|110|
|HTTPS|443|

### UDP(Trnasmission Control-Protocol)

UDP를 통해 통신할 때는 **UDP 헤더**를 데이터에 붙여서 **UDP 데이터그램**을 만들어서 통신에 활용하게 된다.
UDP 헤더는 아래 정보로 구성되어있다.

1.  출발지 포트 번호(16비트)
2.  목적지 포트 번호(16비트)
3.  길이(16비트)
4.  체크섬(16비트)

TCP와 달리 랜에 있는 컴퓨터나 네트워크 장비에 데이터를 일괄로 보낼 수 있으며, 이를 **브로드캐스트(broadcast)**라고 한다.
