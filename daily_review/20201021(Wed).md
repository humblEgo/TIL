1. 학습 날짜 // 2020-10-21(수)
2. 학습시간 // 9:00~22:00

3. 학습 범위 및 주제 // HTTP Response 생성
4. 동료 학습 방법 // sanam, yohai 님과 토의함
5. 학습 목표 // Response 클래스를 구현한다.

---

6. 상세 학습 내용

## CGI

웹 서버에서 동적인 페이지를 보여 주기 위해 임의의 프로그램을 실행할 수 있도록 하는 기술 중 하나. 

원래 웹 서버는 서버에 저장되어 있는 고정된 문서를 보여 주는 역할을 했다. 하지만 웹 서버에서 정보를 찾거나 기록을 하려면 웹 서버를 고쳐서 그런 기능을 넣어야 하는데 버틸 수 없으니, 대신 웹 서버가 특정한 URL로 들어가면 요청을 원하는 프로그램에 적절히 요청을 넘겨주는 기술이 필요해졌는데, CGI가 그런 역할을 한다. 

### CGI의 구조

CGI는 사용자의 요구에 따라 즉석에서 문서를 만들어서 전달하게 된다. 구체적으로는 아래 과정을 따른다.

1. 요청이 웹 서버로 전달되면,
2. 웹 서버는 요청에 들어 있는 주소가 CGI 프로그램에 대응되는지 확인해서, 
3. 대응되면 그 프로그램을 실행해서 환경 변수와 표준 입력의 형태로 요청을 전달한다. 어떻게 전달되는지는 [표준](https://www.w3.org/CGI/)이 있다.
4. 웹 서버는 CGI 프로그램이 표준 출력으로 돌려 보낸 내용을 그대로 응답으로 돌려준다.

오래된 사이트에서는 종종 /cgi-bin/으로 시작하는 주소를 볼 수 있는데, 이는 2번 과정에서 웹 서버가 해당 디렉토리에 들어있는 프로그램을 모두 다 CGI 프로그램으로 인식하도록 되어있는 경우이다. 요즘은 보안 문제 때문에 이런 식으로 하지 않고 웹 서버에서 설정할 수 있도록 해 놓는다.

처음에 CGI 프로그램은 C언어처럼 컴파일 되는 언어를 이용해서 만들어졌으나, 유지보수가 불편하다는 단점이 있었다. 그런데 웹 서버가 흔히 동작하는 유닉스 환경에서는 스크립트 언어를 마치 보통의 실행 파일처럼 실행하는 기능(#!로 시작하는 파일들)이 있기 때문에, CGI 프로그램 또한 이러한 스크립트 언어를 통해 컴파일 없이 동작하는 방법으로 넘어가게 된었따.

### 단점

요청이 하나 들어올 때마다 **프로세스가 하나씩 실행된다는 것이 단점**이다! 프로세스를 하나 더 실행하는 것은 꽤나 비용이 큰 작업이고, 적어도 몇 밀리초는 걸린다. 이는 수많은 요소가 동적으로 작동하는 요즘 웹 환경에서는 큰 병목으로 작용한다.

CGI를 대체하는 대부분의 기술들은 CGI의 이 단점을 해결하기 위해서 나온 것이 보통이다.

- PHP는 웹 서버가 직접 스크립트 언어를 해석하고, 그 결과를 **캐싱해서 빠르게 실행할 수 있도록**하는 방식으로 CGI의 단점을 보완하였다. (PHP 자체가 느려서 이 장점이 상당부분 까먹긴한다고 한다..)
- CGI 프로그램이 한 요청만 처리하고 종료되는 게 아니라, **요청을 계속 처리할 수 있도록 CGI를 개량**한 경우가 있다. 이 중 언어와 상관없는 기술로는 FastCGI와 이의 개량판 SCGI가 대표적이다. 리눅스에서 NGINX로 돌릴 경우, FastCGI 모듈을 이용해서 돌린다.



### CGI 프로그램에서 데이터를 받는 방법

사용자가 <FORM> 태그로 만들어진 입력 양식 문서를 통해 필요한 내용을 입력하고 데이터 보내기 버튼을 누르면 해당 내용이 CGI 프로그램에 전달된다. 그런데 이때 주의할 것은 사용자가 입력한 내용이 그대로 전달되는 것이 아니라, 특정한 방식으로 암호화되어 전달된다는 것이다. 대표적인 암호 방식은 스페이스를 '+' 기호로 바꾸고 'LF+CR'와 같은 것은 '%'에 16진수의 아스키 코드를 붙여서 바꾸는 것이다. 아래 예시처럼!

◐ How are you → How+are+you

또한 입력 양식을 통해 들어온 각 값들은 "변수=값" 이라는 형식으로 CGI에게 전달되며, 2개 이상의 양식이 있을 경우에는 "&" 기호로 각 값들을 연결하게 된다. 예를 들어 다음과 같은 암호화 방법을 사용하고 있다.

◐ name=yhcho&pc=on&sex=male

현재 HTML에서 <FORM>을 통해 보낼 때 사용하는 방법으로 GET과 POST 두 가지가 있다.

- GET으로 보내는 경우: `QUERY_STRING`이라는 환경 변수를 통해 사용자가 입력한 데이터를 보내게 된다.
- POST로 보내는 경우: 표준입력을 통해 사용자가 입력한 데이터를 보낸다.

환경변수에 저장할 수 있는 문자열의 크기가 한정되기 때문에 POST 방식이 권장된다.

### 참고

- [CGI의 개념](https://qaos.com/sections.php?op=viewarticle&artid=194)

- [위키백과](https://ko.wikipedia.org/wiki/%EA%B3%B5%EC%9A%A9_%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4_%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4)

- [나무위키](https://namu.wiki/w/Common%20Gateway%20Interface)
- [sharkynara 블로그](http://sharkynara.egloos.com/1113920)

---

7. 학습 내용에 대한 개인적인 총평

Response 클래스를 설계하기 전에 CGI에 대해서 어떻게 처리할지를 미리 고려해둬야한다고 판단하여 학습을 진행했습니다. 처음부터 CGI를 완전히 고려해서 구현하면 프로젝트 진행이 루즈해질 것이 우려되었습니다. 이에 우선은 정적인 페이지를 응답하는 기능을 만들고, 이후에 CGI로 생성된 데이터를 응답할 수 있는 기능을 붙이겠다고 판단하였습니다. 

의존성없이 유연한 프로그램을 만들어야한다는 것을 뼈속깊이 느낍니다..

---

다음 학습 계획

- response 함수 개발하기
