# 실제로 컴퓨터 끼리는 IP주소를 사용해 데이터를 주고 받는다!

-----

> 2계층에서는 MAC주소를 사용했다면 3계층에서는 IP주소를 사용한다.



## 3계층의 기능



#### 3계층에서 하는 일

- `3계층`은 다른 네트워크 대역. 즉, 멀리 떨어진 곳에 존재하는 네트워크까지 어떻게 데이터를 전달할지 제어하는 일을 담당.

- 쉽게 `LAN`과 `WAN`을 연결시켜 주는게 `3계층`의 역할이다.
- `LAN`과 `WAN`을 연결 시켜주기 위해서는 `라우터`같은 3계층 장비가 필요하다.
- 서로 다른 `LAN`을 연결 시켜 주는 거라 생각해도 무방하다.

#### 3계층에서 쓰는 주소

- `WAN`에서 통신할 때 사용 하는 게 바로 `IP주소`다.

- `IP주소`만 있는 게 아니라
  - `서브넷 마스크`, `기본 게이트웨이`가 추가적으로 필요하다.
    - `서브넷 마스크`  IP주소에 대한 네트워크의 대역을 규정하는 것
    - `게이트웨이 주소` 외부와 통신할 때 사용하는 네트워크의 출입구
    - `IPv4` 현재 PC에 할당된 IP주소

#### 3계층 프로토콜

- `ARP` : `IP주소`를 이용해 `MAC`주소를 알아오는 프로토콜
- `IPv4`: `WAN`에서 통신할 때 사용하는 프로토콜

- `ICMP`: 서로가 통신 되는지 확인할 때 사용하는 프로토콜



-----

## 일반적인 IP 주소



#### Classful IP 주소

> 클래스에 맞게 쓰다보니 주소 낭비가 심하다.

| 클래스               | 네트워크 구분          | 시작 주소 | 마지막 주소     |
| -------------------- | ---------------------- | --------- | --------------- |
| A 클래스             | 0XXXXXXX, 첫 번째 필드 | 0.0.0.0   | 127.255.255.255 |
| B 클래스             | 10XXXXXX, 두 번째 필드 | 128.0.0.0 | 191.255.255.255 |
| C 클래스             | 110XXXXX, 세 번째 필드 | 192.0.0.0 | 223.255.255.255 |
| D 클래스(멀티캐스트) | 1110XXXX               | 224.0.0.0 | 239.255.255.255 |
| E 클래스(예약)       | 1111XXXX               | 240.0.0.0 | 255.255.255.255 |

- IP주소는 4바이트다.
- 쓸 때 10진수로 쓴다.
- 범위를 클래스로 나눠쓴건 초창기의 아이디어.
  - 굳이 알 필요가 없다. 



#### Classless

> 낭비되지 않도록 아껴쓰는 방법이다.
>
> > 하나의 큰 네트워크를 여러 개의 작은 네트워크로 쪼개서 사용하자!
> >
> > > 굳이 . 을 가지고 구분하지 않고( 점을 딱 구분해서 사용했기 때문에 낭비가 너무 심했음) 원하는 곳 어디서든 짤라  쓰자.
> > >
> > > 이걸 가능하게 해주는 게 바로 `서브넷 마스크`
> > >
> > > 이제 `IP주소`는 항상 `서브넷 마스크`와 함께 쓰인다.

- `서브넷 마스크`: 클래스풀한 네트워크 대역을 나눠주는데  사용하는 값. 어디까지가 네트워크 대역을 구분하는데 사용하고 어디서 부터 호스트를 구분하는데 사용하는지 지정.
  - 2진수로 표기했을 때 1로 시작하고, 1과 1 사이에는 0이 올 수 없다는 규칙을 가지고 있다.
    - IP: 192.168.100.68
    - 서브넷 마스크: 255.255.255.192 -> 1111111.11111111.11111111.11000000 -> 24번째 1까지는 네트워크 대역을 구분하고 나머지 0 6개가 몇개의 네트워크 인지 알려줌. 여기서는 0부터 63까지 총 64개가 됨.
    - 만약 1을 늘려서 11111111.11111111.11111111.11100000 -> 이럴 때는 총 32개의 컴퓨터가 들어갈 수 있다.

| 192.168.32.189/26 |                                 |
| ----------------- | ------------------------------- |
| IP주소            | 192.168.32.189                  |
| 서브넷마스크      | 255.255.255.192                 |
| 네트워크ID        | 192.168.32.128                  |
| 브로드캐스트 주소 | 192.168.32.191                  |
| 사용 가능 IP 범위 | 192.168.32.129 ~ 192.168.32.190 |

- 이렇게 클래스리스하게 사용했는데도 IP 주소가 모자르다!!! 
  - 사설, 공인 IP의 등장

#### 사설IP와 공인 IP

> 실제 인터넷 세상에서는 `공인IP`로만 통신한다. 외부 네트워크 대역에서는 `사설IP` 대역이 보이지 않는다.

- 공인IP
  - 공인IP 1개당 2^32개의 사설 IP가 존재한다.
- 어떻게 이걸로 부족 문제를 해결했을까?
  - 사설 네트워크 대역을 사용하는 장비들이 네트워크 통신을 할 때 무조건 공인IP로 바꿔서 네트워크 통신을 한다.
  - 만약 같은 `LAN`을 사용하는 여러 대의 장비들이 있다고 하자.
    - 이 장비들은 서로 다른 `사설IP`를 갖고 있지만 인터넷 통신을 할 때는 모두가 같은 `공인IP`로 강제로 변경돼서 통신하게 된다.
    - 네이버에 `내 ip주소`를 검색하면 나오는 값이 바로 `공인IP`
    - 하지만 `cmd`에 `ipconfig` 명령어를 실행했을 때 나오는 `IP`값은 이 값과 다르다. 왜냐하면 이 값은 `사설 IP`이기 때문.
    - 따라서 같은 `LAN(공유기)`에서 `네이버`에 통신을 한다고 하면 서로 다른 장비들이 통신을 해도 네이버의 입장에서는 같은 IP로 착각한다.
    - 그런데 만약 노트북으로 웹툰을 요청했다면 네이버는 어떻게 요청한 데이터를 내 핸드폰이 아닌 노트북으로 전달해줄까? -- 이 기능은 `공유기`가 해준다.
- **<u>*네트워크 주소를 사설IP에서 공인IP로 바꿔 주는 게 바로 `NAT`*</u>**
  - Network Address Translator
  - 정확하게는 특정한 IP를 특정한 IP로 바꿔주는 기술이다.
- 하나의 가정에서는 보통 3만원씩 내면서 인터넷을 하나 이용하다.
  - 바로 이게 `공인IP`를 하나 사는 거라 생각하면 된다.
    - 그리고 `공유기`가 `사설IP`를 관리 해 준다.
- 그렇다면 공유기가 도대체 어떻게 관리를 해주길래 우리는 하나의 `공인IP`로 여러 개의 `사설IP`를 관리할 수 있는걸까?
  - 데이터를 보낼 때 공유기가 `NAT` 테이블에 기록을 한다. 그리고 응답이 오면 `NAT` 테이블을 보고 그 대상한테 전달 해주는 것.
  - 만약 나간 적이 없는데 들어오면 어떻게 될까?
    - 그냥 공유기가 받고 전달해주지 않고 끝낸다.
- 일반적으로 서버(네이버 서버 등..)는 사설IP를 안쓴다. 왜냐하면 사설IP는 밖에서 보이지 않기 때문에 데이터를 밖으로 보내지 않는 한 데이터가 밖에서 들어오지 않기 떄문이다.
- 다만 데이터를 내보내지 않아도 데이터가 들어올 수 있는 기술이 있는데 이게 바로 `포트 포워딩`



-----

## 특수한 IP 주소



#### 0.0.0.0

- Wildcard 마스크라고도 부른다.
- **나머지** 모든 IP라고 생각하면 된다.

#### 127.0.0.1

- 나 자신을 나타내는 주소
- 만약 네트워크가 안먹힌다면 나 자신한테 ping을 보내보자.

#### 게이트웨이 주소

- 일반적으로 공유기의 IP
- 공유기의 구멍을 보면 유독 하나만 다르다. 자세히 보면 `WAN`이라고 써있는데 이게 바로 외부에서 들어오는 네트워크를 연결하는 곳이다. `공인IP`
- 그리고 나머지 구멍에다가는 `사설 네트워크`로 사용할 랜선을 꽂으면 된다.
- `기본게이트웨이` 에는 사용할 수 있는 가장 작은 값의 IP 주소가 들어 있거나 또는가장 큰 IP를 쓴다. 정해져 있지는 않다.
- 간단하게 `게이트 웨이`는 `사설 네트워크`들이 `외부와 연결될 수 있는 입구` 라고 생각하면 된다.
- 따라서 IP를 설정할 때 기본 게이트웨이를 설정하지 않으면 외부의 네트워크와 통신할 수 없다.

##  실습

- 내 사설IP 알아보기
  - ipconfig /all
- 내 공인IP 알아보기
  - 네이버에 `내 IP`