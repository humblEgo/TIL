## 네트워크 계층

데이터 링크 계층까지의 캡슐화로는 같은 네트워크 내에서만 통신이 가능하다. 따라서 네트워크 간의 통신을 가능하게 하는 추가적인 작업을 네트워크 계층에서 진행하게 된다. 이 계층을 통해 다른 네트워크로 데이터를 전송하려면 라우터(router)라는 네트워크 장비가 필요하다. 라우터를 통해 데이터 송신 경로를 결정하는 과정을 라우팅(routing)이라고 한다. 라우팅은 '라우터'나 '레이어 3 스위치' 장비로 할 수 있다.

### 라우터(router)

해당 목적지까지 어떤 경로로 가는 것이 좋은지를 알려주는 기능을 하는 네트워크 장비. 라우터는 MAC주소 외에 네트워크를 식별할 수 있는 IP주소가 포함된 목적지 주소를 알아야 작동할 수 있다. 라우터는 라우팅 테이블(routing table)로 경로 정보를 등록하고 관리한다.

### 라우터를 통한 네트워크 간 통신

**라우터를 통해 네트워크를 분할**하는 것이 가능하다. 이후 분할한 네트워크 중 다른 네트워크에 속해있는 컴퓨터 간에 데이터를 송수신하기 위해서는 **기본 게이트웨이**를 설정하고, **라우팅**을 진행한다. 이후 라우팅을 통해 파악된 경로를 통해 데이터를 송수신한다.

- 기본 게이트웨이(default gateway)

네트워크의 출입구를 설정하는 것으로 라우터의 IP 주소를 설정하는 것이다. 컴퓨터는 다른 네트워크로 데이터를 보낼 때 어디로 전송해야하는지 알지 못하고, 우선 기본 게이트웨이로, 즉 라우터로 데이터를 전송한다.

### 라우팅

데이터 송신 경로를 결정하는 과정을 뜻하며 **정적 라우팅**과 **동적 라우팅**으로 나누어진다.

- 정적 라우팅
  - 정적 라우팅은 관리자가 미리 라우팅 테이블에 경로를 수동으로 추가하는 방법이다. 경로를 고정, 한정하는 경우에 사용한다. 라우팅 정보가 교환되지 않아서 대역폭에 대한 부담이 적다는 장점이 있다. 단 만약 경로에 장애가 발생해도 다른 경로로 동적으로 우회할 수가 없고 관리자가 설정을 하나하나 변경해야 해서 번거롭다.
- 동적 라우팅
  - 동적 라우팅은 네트워크 변경을 자동으로 감지하여 라우팅 테이블을 업데이트하거나 네트워크 장애가 발생했을 때 라우터끼리 정보를 교환하여 최적의 경로로 전환하는 기능을 한다.

### IP주소

**어떤 네트워크의 어떤 컴퓨터인지를 구분**할 수 있도록 하는 주소. ISP한테 받을 수 있다. IP주소는 32비트로 되어있는 IPv4 버젼과 128비트로 되어있는 IPv6 버젼이 있다. IPv4는 32비트 짜리다보니 개수가 다소 한정되어있는데, 이 때문에 IP주소를 `공인 IP 주소`와 `사설 IP 주소`로 나누어 관리하게 되었다. 공인 IP주소는 ISP가 할당하는데, 보통 라우터에만 할당하고 랜 안에 있는 컴퓨터에는 랜의 네트워크 관리자가 자유롭게 사설 IP주소를 할당하거나 라우터의 DHCP(Dynamic Host Configuration Protocol) 기능을 사용하여 주소를 자동으로 할당하게 된다.

IP주소는 32비트로 구분하기 쉽도록 10진수로 표시한다.

IP주소는 '어떤 네트워크 인지'를 나타내는 **네트워크 ID**와 '해당 네트워크의 어느 컴퓨터'인지를 나타내는 **호스트 ID**로 이루어져 있다.

참고) [What is the difference between public and private IP address?](https://www.iplocation.net/public-vs-private-ip-address)

### IP주소 클래스

IP주소는 **클래스**라는 개념을 통해 네트워크 ID를 크게 만들거나 호스트 ID를 작게 만들어서 네트워크 크기를 조정할 수 있다.

- A 클래스: 대규모 네트워크 주소, 처음 8비트가 네트워크 ID, 나머지 24비트가 호스트 ID --> 호스트는 2^24 - 2개 할당 가능
- B 클래스: 중형 네트워크 주소, 처음 16비트가 네트워크 ID, 나머지 16비트가 호스트 ID --> 호스트는 2^16 - 2개 할당 가능
- C 클래스: 소규모 네트워크 주소, 처음 24비트가 네트워크 ID, 나머지 8비트가 호스트 ID --> 호스트는 2^8 - 2개 할당 가능
- D 클래스: 멀티캐스트(multicast) 주소
- E 클래스: 연구 및 특수용도 주소

2개씩 뺀 것은 네트워크 주소와 브로드캐스트 주소는 호스트에게 할당할 수 없기 때문이다.

### 네트워크 주소, 브로드캐스트 주소

- 네트워크 주소: 전체 네트워크에서 *작은 네트워크*를 식별할 때 사용하는, 해당 네트워크의 대표 주소. 호스트 ID가 모두 0인 주소이다.
- 브로드캐스트 주소: 네트워크에 있는 컴퓨터나 장비 모드에게 한 번에 데이터를 전송하는데 사용되는 전용 IP 주소. 호스트 ID가 모두 1인 주소이다.

### 서브넷

대규모 네트워크를 *작은 네트워크*로 분할하여 브로드캐스트로 전송되는 패킷의 범위를 좁힐 수 있다. 이를 서브넷팅(subneting)이라고 하며, **분할된 네트워크를 서브넷(subnet)**이라고 한다. 서브넷팅이 진행되면, IP주소는 네트워크 ID, 서브넷 ID, 호스트 ID로 나누어지게 된다. 이 때 네트워크 ID와 호스트 ID를 식별하기 위한 서브넷 마스크를 활용한다.

- 서브넷 마스크
  네트워크 ID 영역과 서브넷 ID 영역을 1로 채우고, 호스트 ID 영역은 0으로 채운 값으로, 비트연산을 통해 subnet ID를 구하는데 쓰인다. \*\*ex) C클래스에서 4비트를 서브넷 ID로 쓰고 싶다면, 서브넷 마스크는 `255. 255. 255. 240`이 된다. 이는 prefix 표기법으로 값이 1인 비트 수를 슬래시와 함께 적어서 `/28`로도 나타낼 수 있다.

### 네트워크 계층의 캡슐화

네트워크 계층에서는 프레임에 IP 헤더를 붙인다. 이렇게 만들어진 것을 `IP 패킷` 이라고 한다. IP 헤더는 아래 내용들이 순서대로 구성되어있다.

1.  version: IPv4 or IPv6
2.  header length
3.  service type
4.  total lenght: 전체 패킷 길이
5.  ID: 일련번호
6.  flags: 조각 상태
7.  fragment offset: 조각의 위치
8.  TTL
9.  protocol
10. header checksum
11. source IP address
12. destination IP address
