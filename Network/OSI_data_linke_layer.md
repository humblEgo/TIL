## 데이터 링크 계층

**네트워크 장비 간에 신호를 주고받는 규칙**을 정하는 계층이다. 가장 많이 사용되는 규칙은 이더넷이다.

### 이더넷(Ethernet)

허브와 같은 장비에 연결된 컴퓨터와 데이터를 주고 받을 때 사용한다. 데이터에 목적지 정보를 추가하여 데이터를 원하는 목적지에 보낼 수 있도록 한다. 또한 여러 컴퓨터에서 동시에 데이터를 전송해도 충돌이 일어나지 않도록 CSMA/CD(Carrier Sense Multiple Access with Collision Detection, 반송파 감지 다중 접속 및 충돌 탐지)를 통해 데이터 전송 시점을 조절한다. 즉, 케이블에 데이터가 흐르고 있는지 확인하고, 흐르고 있다면 기다렸다가 충돌이 나지 않는 시점에 데이터를 송신하는 것이다. 사실 요즘은 이런 방식이 효율이 좋지 않아서 거의 사용되지 않고 있고, 스위치 장비를 통해 충돌을 방지하고 있다.

### 이더넷 헤더

데이터 링크 계층에서는 데이터에 **이더넷 헤더**와 **트레일러**를 붙인다. 이더넷 헤더와 트레일러가 추가된 데이터를 **프레임**이라고 한다.

- 이더넷 헤더(ethernet header): 목적지 MAC주소(6바이트), 출발지 MAC주소(6바이트), 이더넷유형(2바이트)로 총 14바이트로 구성됨.
  - 이더넷유형(ethernet type): 이더넷으로 전송되는 상위 계층 프로토콜의 종류를 나타냄. 가령 IPv4는 0800, IPv6는 86DD이다.
- 트레일러(trailer): FCS(Frame Check Sequence)라고도 하는데 데이터 전송 도중에 오류가 발생하는지 확인하는 용도로 사용함.

### 이더넷 규격

이더넷은 케이블의 종류나 통신 속도에 따라 다양한 규격으로 분류된다. 규격 이름은 통신속도, 전송방식, 케이블로 구성되어있다. _ex) 규격이름 `10BASE5`의 10은 통신속도, BASE는 전송방식, T는 케이블 종류를 뜻한다._

### 스위치(switch)

데이터 링크 계층에서 동작하고 **레이어 2 스위치** 혹은 **스위칭 허브**라고도 한다. 내부에 스위치의 포트 번호와 해당 포트에 연결되어 있는 컴퓨터의 MAC 주소가 등록되는 데이터베이스인 MAC 주소 테이블(MAC address table, bridge table)가 있다. 아직 MAC 주소 테이블에 MAC 주소가 등록되어있지 않은 MAC주소를 헤더로 가진 프레임을 전송할 경우, 송신 포트를 제외한 모든 포트에 프레임을 송신하는 **플러딩(flooding)** 과정을 거친 후, MAC 주소를 등록한다. MAC 주소 테이블에 MAC 주소가 등록되어있는 경우에는 해당 MAC 주소만을 목적지로 선택하는 **MAC 주소 필터링** 과정을 거친 후 프레임을 전송한다.

### ARP(Address Resolution Protocol)

목적지 컴퓨터의 IP 주소를 이용하여 MAC 주소를 찾기 위한 프로토콜. 아래 과정을 거친다.

1.  ARP 요청: 출발지 컴퓨터가 목적지 주소를 모르면 MAC 주소를 알아내기 위해 네트워크에 브로드캐스트를 하는 것.
2.  ARP 응답: ARP 요청시 지정된 IP 주소를 가지고 있는 컴퓨터는 MAC 주소를 응답으로 보내는 것.

이 응답으로 받은 정보를 메모리에 보관하는데 이를 ARP table 이라고 한다. 이후엔 이 ARP table을 참고하여 데이터가 송신된다. 한편 IP 주소가 변경되면 해당 MAC 주소도 함께 변경되므로, ARP 테이블에서 보존 기간을 ARP 캐시로 지정하고 일정 시간이 지나면 삭제하고 다시 ARP 요청을 한다.

### 전이중 통신과 반이중 통신

데이터를 동시에 전송하는 방식이 전이중 통신, 회선 하나로 데이터 송수신을 번갈아가면서 진행하는 방식을 반이중 통신이라고 한다. 스위치 이용시 전이중 통신이 가능하고, 단순 허브를 사용시에는 반이중 통신 방식을 사용하게 된다. 데이터가 충돌되면, 그 충돌의 영향이 미치는 범위를 충돌 도메인(collision domain)이라고 하는데, 전이중 통신은 충돌이 일어나지 않지만 충돌이 일어난다고 해도 해당 포트에 연결되어있는 컴퓨터에만 영향을 미치는 반면, 반이중 통신에서는 충돌이 일어날 경우 모든 포트의 컴퓨터가 충돌 도메인이 된다. 대참사..
